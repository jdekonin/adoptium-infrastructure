---
###################
# NVidia CUDA 5.5 #
###################

# Install CUDA 5.5 on RedHat 6 | 7 and CentOS 6 | 7 x86-64

- name: Check if NVidia CUDA 5.5 toolkit is aready installed
  stat:
      path: /usr/local/cuda-5.5
  register: cuda55_installed
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
    - ansible_architecture == "x86_64"
  tags: nvidia_cuda_toolkit_55

- name: Download NVidia CUDA 5.5 toolkit
  get_url:
    url: http://developer.download.nvidia.com/compute/cuda/5_5/rel/installers/cuda_5.5.22_linux_64.run
    dest: '/tmp/cuda_55_linux-run'
    timeout: 600
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
    - ansible_architecture == "x86_64"
    - cuda55_installed.stat.exists == False
  tags: nvidia_cuda_toolkit_55

- name: Install NVidia CUDA 5.5 toolkit
  shell: sh /tmp/cuda_55_linux-run --silent --toolkit --override
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
    - ansible_architecture == "x86_64"
    - cuda55_installed.stat.exists == False
  tags: nvidia_cuda_toolkit_55

- name: Clean up downloaded packages
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /tmp/cuda_55_linux-run
  when:
    - ansible_distribution == "RedHat" or ansible_distribution == "CentOS"
    - ansible_architecture == "x86_64"
    - cuda55_installed.stat.exists == False
  ignore_errors: yes
  tags: nvidia_cuda_toolkit_55
