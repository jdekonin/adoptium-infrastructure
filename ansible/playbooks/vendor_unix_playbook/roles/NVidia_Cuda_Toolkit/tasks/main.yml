---
###################
# NVidia CUDA 7.5 #
###################

# Install CUDA 7.5 on Ubuntu 14, RedHat 6 | 7 and CentOS 6 | 7 x86-64

- name: Check if NVidia CUDA 7.5 toolkit is aready installed
  stat:
      path: /usr/local/cuda-7.5
  register: cuda75_installed
  when:
    - (ansible_distribution == "Ubuntu" and ansible_distribution_major_version == "14") or (ansible_distribution == "RedHat" or ansible_distribution == "CentOS")
    - ansible_architecture == "x86_64"
  tags: vendor_nvidia_cuda_toolkit

- name: Download NVidia CUDA 7.5 toolkit
  get_url:
    url: http://developer.download.nvidia.com/compute/cuda/7.5/Prod/local_installers/cuda_7.5.18_linux.run
    dest: '/tmp/cuda_75_linux-run'
    timeout: 600
  when:
    - (ansible_distribution == "Ubuntu" and ansible_distribution_major_version == "14") or (ansible_distribution == "RedHat" or ansible_distribution == "CentOS")
    - ansible_architecture == "x86_64"
    - cuda75_installed.stat.exists == False
  tags: vendor_nvidia_cuda_toolkit

- name: Install NVidia CUDA 7.5 toolkit
  shell: sh /tmp/cuda_75_linux-run --silent --toolkit --override
  when:
    - (ansible_distribution == "Ubuntu" and ansible_distribution_major_version == "14") or (ansible_distribution == "RedHat" or ansible_distribution == "CentOS")
    - ansible_architecture == "x86_64"
    - cuda75_installed.stat.exists == False
  tags: vendor_nvidia_cuda_toolkit

- name: Clean up downloaded packages
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /tmp/cuda_75_linux-run
  when:
    - (ansible_distribution == "Ubuntu" and ansible_distribution_major_version == "14") or (ansible_distribution == "RedHat" or ansible_distribution == "CentOS")
    - ansible_architecture == "x86_64"
    - cuda75_installed.stat.exists == False
  ignore_errors: yes
  tags: vendor_nvidia_cuda_toolkit
